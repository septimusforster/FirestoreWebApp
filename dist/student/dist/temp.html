<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pre-registration</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: url('../img/depositphotos_354431824-stock-illustration-vector-illustration-black-honeycomb-abstract.jpg');
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            color: #fff;
            /* background-color: rgb(42,7,75); */
        }
        main.wrapper {
            /* height: 100vh; */
            /* min-height: 1000px; */
            background-color: rgba(42,7,75,.9);
            display: grid;
            grid-template-rows: repeat(7, 1fr);
            position: relative;
        }
        header, .banner, section {
            grid-column: 1/2;
            display: flex;
            align-items: center;
            font-size: 1.2em;
        }
        header {
            grid-row: 1/1;
            justify-content: space-around;
            /* position: sticky;
            top: 0; */
            background-color: rgba(42,7,75);
        }
        .banner {
            grid-row: 2/4;
            justify-content: space-around;
            align-items: flex-start !important;
            line-height: 2;
            /* border: 1px solid white; */
            padding: 20px;
            background-color: rgba(0,0,0,.2);
        }
        .banner div {
            flex-basis: 27%;
            min-width: 200px;
        }
        section {
            grid-row: 3/-1;
            justify-content: space-around;
            align-items: flex-start !important;
            padding: 50px;
            margin-top: 10px;
        }
        div#photo-section {
            flex-basis: 20%;
        }
        div#subject-section {
            flex-basis: 25%;
            position: relative;
        }
        .deactivate {
            pointer-events: none;
            opacity: 0;
            display: none;
        }
        section > div {
            flex-basis: 20%;
            min-width: 300px;
            /* height: 300px; */
            min-height: 400px;
            max-height: 700px;
            background-color: rgb(255,255,255);
            border-radius: 10px;
            overflow: hidden;
        }
        header h1 {
            font-weight: 100;
        }
        div.header {
            background-color: rgba(0,0,0,.2);
            color: #333;
            position: sticky;
            top: 0;
            margin-bottom: 7px;
            /* border-bottom: 1px solid #777; */
        }
        div.header label, div.header #counter {
            display: inline-block;
        }
        div.header label {
            padding: 10px;
            margin: 10px;
        }
        input#photoSrc {
            display: none;
        }
        input#all {
            margin-left: 20px;
        }
        div.header #counter {
            text-align: center;
            width: 30px;
            padding: 20px;
            float: right;
            background-color: #ddd;
        }
        #formBody {
            height: 450px;
            /* padding: 10px 0; */
            overflow-y: scroll;
            /* border: 1px solid red; */
            position: relative;
        }
        #formBody::-webkit-scrollbar {/*.formBody*/
            width: 0.7em;
            transition: all .1s ease-in-out;
        }
        #formBody:hover::-webkit-scrollbar-track {/*.formBody*/
            background-color: #fff;
            border-radius: 20px;
        }
        #formBody:hover::-webkit-scrollbar-thumb {/*.formBody*/
            background-color: #777;
            border-radius: 20px;
        }
        #formBody label {/*.formBody*/
            display: block;
            padding: 7px 14px;
            color: #333;
            cursor: pointer;
            transition: all .1s ease-in-out;
        }
        #formBody label:hover {/*.formBody*/
            background-color: rgba(100,100,100,.1);
        }
        #photoBody {
            width: 250px;
            height: 250px;
            border: 1px solid #ccc;
            border-radius: 50%;
            overflow: hidden;
            margin: auto;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .footer {
            position: sticky;
            bottom: 0;
            padding: 10px;
            direction: rtl;
            margin-top: 10px;
            border-top: 1px solid #aaa;
        }
        .footer input, #skip-btn {
            padding: 10px 20px;
            margin: 10px;
            background-color: rgba(100,100,100,.3);
            font-size: 1em;
            color: #333;
            border-radius: 7px;
            transition: all .1s ease-in-out;
        }
        .footer input:hover {
            background-color: #007960;
            color: #fff;
        }
        #skip-btn:hover {
            background-color: rgb(42,7,75);
            color: #fff;
        }
        button, input {
            border: none;
            outline: none;
            cursor: pointer;
        }
        ::backdrop {
            background-color: rgba(42,7,75,.5);
        }
        dialog {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            margin: auto;
            text-align: center;
            border: none;
        }
        output {
            padding: 20px;
            font-size: 2rem;
        }
    </style>
</head>
<body>
    <main class="wrapper">
        <header>
            <h1>Photo</h1>
            <h1>Subject</h1>
        </header>
        <div class="banner">
            <div>Personalize your "homing" page with a passport photograph of you donning your school's uniform.<br/>Mind this is a one-off operation.</div>
            <div>Select the range of subjects you offer;<br/>only Senior Secondary students have provision to amend them.</div>
        </div>
        <section>
            <div id="photo-section">
                <div class="header">
                    <input type="file" name="photo_src" id="photoSrc" accept="image/*"><label for="photoSrc">&plus; Pick a photo</label>
                </div>
                <form action="" name="photoForm">
                    <div id="photoBody">
                        <img src="" alt="photo-preview" width="250">
                    </div>
                    <div class="footer">
                        <button type="button" id="skip-btn" class="deactivate">Skip</button>
                        <input type="submit" value="Upload" class="deactivate">
                    </div>
                </form>
            </div>
            <div id="subject-section">
                <div class="header">
                    <input type="checkbox" name="all" id="all" /><label for="all">Select all</label>
                    <span id="counter">0</span>
                </div>
                <form action="" name="subjectForm">
                    <div id="formBody">
                        
                    </div>
                    <div class="footer">
                        <input type="submit" value="Submit"/>
                        <!-- <button type="submit">Submit</button> -->
                    </div>
                </form>
            </div>
        </section>
    </main>
    <dialog id="success">
        <output></output>
        <p></p>
    </dialog>
    <script>
        const formBody = document.getElementById('formBody');
        const ss = JSON.parse(sessionStorage.getItem('snapshot'));
        const wrapperChildren = document.querySelector('.wrapper').children;
        window.addEventListener('load', (e) => {

            let params = new URL(document.location).searchParams;
            const offered = parseInt(params.get('of'));
            const photosrc = parseInt(params.get('ps'));
            if (offered) {
                for(i = 0; i < wrapperChildren.length; i++) {
                    wrapperChildren[i].lastElementChild.classList.add('deactivate');
                }
                skipBtn.classList.remove('deactivate')
            } else {
                let reserved = Object.entries(ss.reservedPayload);
                reserved.forEach((sub, i) => {
                    formBody.insertAdjacentHTML('beforeend', `
                    <label id="cb${i+1}">
                        <input type="checkbox" name="offered" id="cb${i+1}" value="${sub[0]}" /> ${sub[1]}
                    </label>
                    `)
                })
            }
            if (photosrc) {
                for(i = 0; i < wrapperChildren.length; i++) {
                    wrapperChildren[i].firstElementChild.classList.add('deactivate');
                }
            }
        })
        const skipBtn = document.querySelector('#skip-btn');
        skipBtn.onclick = function () {
            location.replace('./index.html')
        }
        // console.log(JSON.parse(sessionStorage.snapshot))
        const subjectForm = document.forms.subjectForm;
        const photoForm = document.forms.photoForm;
        const selectAll = document.querySelector('input#all');
        const counter = document.querySelector('#counter');
        selectAll.onclick = function (e) {
            if (selectAll.checked) {
                subjectForm.querySelectorAll("input[type='checkbox']").forEach(input => {
                    input.checked = true;
                });
                e.target.nextElementSibling.innerText = "Unselect all";
            } else {
                subjectForm.querySelectorAll("input[type='checkbox']").forEach(input => {
                    input.checked = false;
                });
                e.target.nextElementSibling.innerText = "Select all";
            }
            counter.textContent = subjectForm.querySelectorAll("input[type='checkbox']:checked").length;
        }

        subjectForm.addEventListener('change', (e) => {
            counter.textContent = subjectForm.querySelectorAll("input[type='checkbox']:checked").length;
            if (counter.textContent == subjectForm.querySelectorAll("input[type='checkbox']").length) {
                selectAll.checked = true;
                selectAll.nextElementSibling.innerText = "Unselect all";
            } else {
                selectAll.checked = false;
                selectAll.nextElementSibling.innerText = "Select all";
            }
        })
        
    </script>
    <script type="module" src="../src/temp_bundle.js"></script>
</body>
</html>